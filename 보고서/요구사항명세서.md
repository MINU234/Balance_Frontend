# Balance Game 요구사항 정의서 (서비스 운영 중)

## 🌐 **현재 서비스 상태**
- **서비스 URL**: https://balance-game-ekedbfhkcxeyc8cb.koreacentral-01.azurewebsites.net
- **API 기본 경로**: `/api`
- **상태**: 정상 운영 중 ✅ 
- **배포 환경**: Microsoft Azure (Korea Central)
- **마지막 업데이트**: 2025년 1월 14일

## 1. 서비스 개요
다양한 주제(키워드)의 밸런스 게임 질문을 제공하고, 사용자가 원하는 질문을 조합하여 자신만의 **질문 묶음(컬렉션)**을 만들고 8자리 공유코드로 공유할 수 있는 웹 서비스입니다.

### 🎯 핵심 가치
- **개인 중심 플레이**: 혼자서 게임하고 결과를 공유코드로 비교
- **품질 보장**: 관리자 승인제를 통한 고품질 콘텐츠
- **접근성**: 비회원도 즉시 게임 플레이 가능
- **확장성**: 체계적인 권한 관리와 API 구조

## 2. 기능 요구사항 (구현 완료)

### 2.1. 비회원 기능 (API 구현 완료)

#### 🔍 질문 및 묶음 탐색
- **인기 질문 조회**: `GET /api/questions/popular` - 승인된 인기 질문 페이징 조회
- **인기 묶음 조회**: `GET /api/question-bundles/popular` - 공개된 인기 묶음 조회  
- **묶음 검색**: `GET /api/question-bundles/search?query={검색어}` - 키워드 기반 묶음 검색
- **묶음 상세 조회**: `GET /api/question-bundles/{id}` - 특정 묶음의 질문 목록 조회

#### 🎮 개인 중심 밸런스 게임 플레이
- **게임 시작**: `POST /api/game/start` - 임시 사용자 ID로 게임 시작
- **답변 제출**: `POST /api/game/answer` - A/B 선택지 답변 제출
- **게임 완료**: `POST /api/game/sessions/{sessionId}/complete` - 8자리 공유코드 자동 생성
- **공유코드 검증**: `GET /api/game/share/{shareCode}/validate` - 공유코드 유효성 확인

#### 📊 결과 확인 및 비교
- **게임 결과 조회**: `GET /api/game/sessions/{sessionId}/results` - 개인 플레이 결과 
- **공유코드로 세션 조회**: `GET /api/game/share/{shareCode}` - 공유코드로 게임 정보 조회
- **결과 비교**: `POST /api/game/compare?shareCode={코드}&compareSessionId={세션ID}` - 일치율 계산 및 문항별 비교

### 2.2. 일반 회원 기능 (JWT 인증 필요)

#### 🔐 인증 시스템
- **회원가입**: `POST /api/auth/signup` - 이메일/비밀번호 계정 생성
- **로그인**: `POST /api/auth/login` - JWT 토큰 발급 (HttpOnly 쿠키 방식)
- **로그아웃**: `POST /api/auth/logout` - 토큰 무효화
- **내 정보 조회**: `GET /api/auth/me` - 현재 로그인한 사용자 정보

#### 📝 질문 묶음 관리
- **묶음 생성**: `POST /api/question-bundles` - 승인된 질문들로 새 묶음 생성
- **내 묶음 조회**: `GET /api/my/question-bundles` - 생성한 묶음 목록 페이징
- **묶음 상세 조회**: `GET /api/question-bundles/{id}` - 특정 묶음 세부 정보
- **공개/비공개 설정**: 묶음 생성 시 isPublic 옵션으로 공개 여부 결정

#### ❓ 질문 생성 (승인제)
- **질문 생성 요청**: `POST /api/questions` - 새 질문 등록 (PENDING 상태)
- **내 질문 조회**: `GET /api/my/questions` - 생성한 모든 질문 (모든 상태)
- **상태별 질문 조회**: `GET /api/my/questions/status/{PENDING|APPROVED|REJECTED}` - 승인 상태별 필터링

#### 📊 마이페이지
- **게임 기록**: `GET /api/my/game-history` - 플레이한 게임 이력 조회
- **통계 정보**: `GET /api/my/stats` - 질문/묶음/게임 통계
  ```json
  {
    "totalQuestions": 50,
    "approvedQuestions": 30,
    "pendingQuestions": 15,
    "rejectedQuestions": 5,
    "totalBundles": 10,
    "totalGamesPlayed": 100
  }
  ```

### 2.3. 관리자 전용 기능 (ADMIN 권한 필요)

#### 🛡️ 질문 승인 관리
- **승인 대기 목록**: `GET /api/admin/questions/pending` - PENDING 상태 질문 조회
- **질문 승인**: `POST /api/admin/questions/{id}/approve` - 단일 질문 승인
- **질문 거절**: `POST /api/admin/questions/{id}/reject` - 거절 사유와 함께 처리
- **일괄 승인**: `POST /api/admin/questions/bulk-approve` - 다수 질문 한번에 승인
- **승인 이력**: `GET /api/admin/questions/history?status={상태}` - 처리 완료된 질문 이력

#### 📊 관리자 대시보드
- **통계 조회**: `GET /api/admin/questions/stats` - 전체 서비스 통계
  ```json
  {
    "dailyStats": {...},
    "keywordPendingStats": {...},
    "adminActivityStats": {...}
  }
  ```

### 2.4. 공통 기능

#### 🔐 보안 및 인증
- **JWT 기반 인증**: HttpOnly 쿠키 방식으로 XSS 방어
- **OAuth2 소셜 로그인**: Spring Security OAuth2 Client (구글, 카카오 준비)
- **CORS 설정**: 프론트엔드 도메인 허용
- **역할 기반 접근 제어**: USER, ADMIN 권한 분리

#### 📱 API 설계
- **RESTful API**: 표준 HTTP 메서드 사용
- **페이징 지원**: Pageable 객체로 일관된 페이징
- **예외 처리**: GlobalExceptionHandler로 통일된 에러 응답
- **검증**: Bean Validation 적용

3. 비기능 요구사항
   사용성: 사용자가 별도의 학습 없이도 서비스를 직관적으로 이해하고 사용할 수 있어야 합니다.

성능: 페이지 로딩과 게임 진행 시 사용자가 답답함을 느끼지 않도록 빠른 응답 속도를 유지해야 합니다.

확장성: 향후 사용자와 데이터가 증가하더라도 안정적으로 서비스를 운영할 수 있도록 설계되어야 합니다.

보안: 사용자 개인 정보와 데이터는 안전하게 보호되어야 하며, 인증이 필요한 기능에 비인가 사용자가 접근할 수 없어야 합니다.

유지보수성: 코드 구조가 명확하고 체계적이어서 새로운 기능을 추가하거나 기존 기능을 수정하기 용이해야 합니다.

## 📋 요구사항 개선

### 🔄 **주요 특징**

- **관리자 승인제**: 모든 질문의 등록/편집/삭제가 관리자 검토를 거쳐 반영
- **개인 중심 플레이**: 혼자서 게임하고 8자리 공유코드로 결과 비교
- **체계적 권한 관리**: 비회원 → 일반회원 → 관리자 3단계 권한 구분

### 📱 **비회원 기능**

- ✅ 질문/묶음 탐색 및 검색
- ✅ **개인별** 밸런스 게임 플레이
- ✅ **8자리 공유코드** 생성 및 공유
- ✅ **결과 비교** 및 일치율 계산

### 👤 **일반 회원 기능**

- ✅ 질문 묶음 생성/편집/삭제
- ✅ **질문 요청** (승인제)
- ✅ 묶음 복제(Clone)
- ✅ 마이페이지 (게임 기록, 요청 상태 등)

### 🔧 **관리자 전용 기능**

- ✅ **질문 승인 관리** (요청 검토/승인/거절)
- ✅ **콘텐츠 품질 관리** (중복 탐지, 부적절 콘텐츠 차단)
- ✅ **시스템 관리** (사용자 관리, 통계 모니터링)

### 🎮 **게임 플레이 플로우**

1. **개인이 혼자** 질문 묶음 플레이
2. 완료 후 **8자리 공유코드** 자동 생성
3. 친구가 공유코드로 같은 질문 플레이
4. **일치율 자동 계산** 및 문항별 비교 표시

### 🛡️ **질문 승인 플로우**

1. 사용자가 질문 생성/수정/삭제 **요청**
2. **승인 대기** 상태로 저장
3. 관리자가 검토 후 **승인/거절**
4. 승인시 서비스 반영, 거절시 사유 안내

### 🎯 **핵심 가치**

- **품질 보장**: 승인제를 통한 고품질 콘텐츠
- **소셜 연결**: 공유코드 기반 친구 비교
- **사용 편의**: 언제든 혼자서 플레이 가능
- **확장성**: 체계적 관리 시스템
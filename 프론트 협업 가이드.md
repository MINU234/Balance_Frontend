# ë°¸ëŸ°ìŠ¤ ê²Œì„ ë°±ì—”ë“œ API í˜‘ì—… ê°€ì´ë“œ

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

### ì‹œìŠ¤í…œ êµ¬ì¡°
- **í”„ë ˆì„ì›Œí¬**: Spring Boot 3.2.6 (Java 17)
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL
- **ORM**: JPA + QueryDSL
- **ì¸ì¦**: JWT + OAuth2 (ì†Œì…œ ë¡œê·¸ì¸)
- **íŒŒì¼ ì €ì¥**: Azure Blob Storage
- **ë¹Œë“œ ë„êµ¬**: Gradle

### í•µì‹¬ ê¸°ëŠ¥
1. **ë°¸ëŸ°ìŠ¤ ê²Œì„ í”Œë ˆì´ ì‹œìŠ¤í…œ** - íšŒì›/ë¹„íšŒì› ëª¨ë‘ ê²Œì„ ê°€ëŠ¥
2. **ì§ˆë¬¸ ìƒì„± ë° ìŠ¹ì¸ ì‹œìŠ¤í…œ** - íšŒì›ì´ ì§ˆë¬¸ ìƒì„±, ê´€ë¦¬ì ìŠ¹ì¸ í›„ ê³µê°œ
3. **8ìë¦¬ ê³µìœ  ì½”ë“œ ì‹œìŠ¤í…œ** - ê²Œì„ ê²°ê³¼ ê³µìœ  ë° ë¹„êµ
4. **ì†Œì…œ ë¡œê·¸ì¸** - OAuth2 ê¸°ë°˜ ê°„í¸ ë¡œê·¸ì¸
5. **ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ** - ì§ˆë¬¸ ìŠ¹ì¸/ê±°ì ˆ ê´€ë¦¬

---

## ğŸš€ API ì—”ë“œí¬ì¸íŠ¸ ê°€ì´ë“œ

### ğŸ® ê²Œì„ í”Œë ˆì´ ê´€ë ¨ API

### ë°±ì—”ë“œ API ì£¼ì†Œ : https://balance-game-ekedbfhkcxeyc8cb.koreacentral-01.azurewebsites.net/api

#### 1. ê²Œì„ ì‹œì‘
```http
POST /api/game/start
Content-Type: application/json

# íšŒì› ê²Œì„ ì‹œì‘
{
  "bundleId": 1,
  "userEmail": "user@example.com"
}

# ë¹„íšŒì› ê²Œì„ ì‹œì‘
{
  "bundleId": 1,
  "tempUserId": "temp-unique-id-123"
}

# ê³µìœ  ì½”ë“œë¡œ ë¹„êµ ê²Œì„ ì‹œì‘
{
  "bundleId": 1,
  "shareCode": "ABC12345",
  "tempUserId": "temp-unique-id-456"
}
```

**ì‘ë‹µ**:
```json
{
  "sessionId": 123,
  "bundleId": 1,
  "bundleTitle": "ì—°ì•  ë°¸ëŸ°ìŠ¤ ê²Œì„",
  "totalQuestions": 10,
  "questions": [
    {
      "questionId": 1,
      "text": "ì²« ë°ì´íŠ¸ ì¥ì†ŒëŠ”?",
      "optionAText": "ì˜í™”ê´€",
      "optionBText": "ì¹´í˜",
      "optionAImageUrl": "https://...",
      "optionBImageUrl": "https://..."
    }
  ]
}
```

#### 2. ë‹µë³€ ì œì¶œ
```http
POST /api/game/answer
Content-Type: application/json

{
  "sessionId": 123,
  "questionId": 1,
  "selectedOption": "A"  // A ë˜ëŠ” B
}
```

#### 3. ê²Œì„ ì™„ë£Œ ë° ê³µìœ ì½”ë“œ ë°›ê¸°
```http
POST /api/game/sessions/123/complete
```

**ì‘ë‹µ**:
```json
{
  "shareCode": "ABC12345"
}
```

#### 4. ê²Œì„ ê²°ê³¼ ì¡°íšŒ
```http
GET /api/game/sessions/123/results
```

**ì‘ë‹µ**:
```json
{
  "sessionId": 123,
  "bundleTitle": "ì—°ì•  ë°¸ëŸ°ìŠ¤ ê²Œì„",
  "shareCode": "ABC12345",
  "userChoices": {
    "1": "A",
    "2": "B",
    "3": "A"
  },
  "totalQuestions": 10
}
```

#### 5. ê³µìœ ì½”ë“œë¡œ ì„¸ì…˜ ì¡°íšŒ
```http
GET /api/game/share/ABC12345
```

#### 6. ê²°ê³¼ ë¹„êµ
```http
POST /api/game/compare?shareCode=ABC12345&compareSessionId=456
```

**ì‘ë‹µ**:
```json
{
  "originalSessionId": 123,
  "compareSessionId": 456,
  "bundleTitle": "ì—°ì•  ë°¸ëŸ°ìŠ¤ ê²Œì„",
  "matchRate": 70.0,
  "matchCount": 7,
  "totalQuestions": 10,
  "comparisons": {
    "1": {
      "questionId": 1,
      "originalChoice": "A",
      "compareChoice": "A",
      "isMatch": true
    }
  }
}
```

### ğŸ“ ì§ˆë¬¸ ê´€ë¦¬ API

#### ì§ˆë¬¸ ìƒì„± (íšŒì› ì „ìš©)
```http
POST /api/questions
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "text": "ì•„ì¹¨í˜• ì¸ê°„ vs ì €ë…í˜• ì¸ê°„",
  "optionAText": "ì•„ì¹¨í˜• ì¸ê°„",
  "optionBText": "ì €ë…í˜• ì¸ê°„", 
  "keyword": "ë¼ì´í”„ìŠ¤íƒ€ì¼",
  "optionAImageUrl": "https://example.com/image1.jpg",
  "optionBImageUrl": "https://example.com/image2.jpg"
}
```

#### ì§ˆë¬¸ ë¬¶ìŒ ì¡°íšŒ
```http
GET /api/question-bundles?page=0&size=20&keyword=ì—°ì• 
```

#### ì¸ê¸° ì§ˆë¬¸ ì¡°íšŒ
```http
GET /api/questions/popular?page=0&size=20
```

### ğŸ” ì¸ì¦ API

#### ë¡œê·¸ì¸
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

**ì‘ë‹µ**:
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "userInfo": {
    "id": 1,
    "email": "user@example.com",
    "nickname": "ì‚¬ìš©ìë‹‰ë„¤ì„",
    "role": "USER"
  }
}
```

#### íšŒì›ê°€ì…
```http
POST /api/auth/signup
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "nickname": "ì‚¬ìš©ìë‹‰ë„¤ì„"
}
```

### ğŸ‘¤ ë§ˆì´í˜ì´ì§€ API

#### ë‚´ ê²Œì„ ê¸°ë¡ ì¡°íšŒ
```http
GET /api/my/game-history?page=0&size=10
Authorization: Bearer {access_token}
```

#### ë‚´ ì§ˆë¬¸ ì¡°íšŒ
```http
GET /api/my/questions?status=PENDING&page=0&size=10
Authorization: Bearer {access_token}
```

#### ë‚´ í†µê³„ ì¡°íšŒ
```http
GET /api/my/stats
Authorization: Bearer {access_token}
```

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### í•µì‹¬ ì—”í‹°í‹°

#### User (ì‚¬ìš©ì)
```sql
user_id         BIGINT PRIMARY KEY
email           VARCHAR(255) UNIQUE
nickname        VARCHAR(50) UNIQUE NOT NULL
password        VARCHAR(255)
provider        VARCHAR(50)         -- OAuth ì œê³µì
provider_id     VARCHAR(255)        -- OAuth ID
role            VARCHAR(20)         -- USER, ADMIN
created_at      TIMESTAMP
updated_at      TIMESTAMP
```

#### Question (ì§ˆë¬¸)
```sql
question_id         BIGINT PRIMARY KEY
text               VARCHAR(500) NOT NULL
option_a_text      VARCHAR(255) NOT NULL
option_b_text      VARCHAR(255) NOT NULL
keyword            VARCHAR(50)
creator_id         BIGINT               -- User ì°¸ì¡°
approval_status    VARCHAR(20)          -- PENDING, APPROVED, REJECTED
rejection_reason   VARCHAR(500)
approved_by        BIGINT               -- User ì°¸ì¡° (ê´€ë¦¬ì)
approved_at        TIMESTAMP
option_a_image_url VARCHAR(2048)
option_b_image_url VARCHAR(2048)
is_active          BOOLEAN DEFAULT true
created_at         TIMESTAMP
updated_at         TIMESTAMP
```

#### GameSession (ê²Œì„ ì„¸ì…˜)
```sql
session_id              BIGINT PRIMARY KEY
bundle_id               BIGINT NOT NULL     -- QuestionBundle ì°¸ì¡°
player_user_id          BIGINT              -- User ì°¸ì¡° (íšŒì›ì¸ ê²½ìš°)
temp_user_id           VARCHAR(50)         -- ë¹„íšŒì› ì‹ë³„ì
share_code             VARCHAR(8) UNIQUE   -- ê³µìœ  ì½”ë“œ
share_code_created_at  TIMESTAMP
share_code_expires_at  TIMESTAMP
parent_session_id      BIGINT              -- ë¹„êµ ëŒ€ìƒ ì„¸ì…˜
session_status         VARCHAR(20)         -- IN_PROGRESS, COMPLETED, EXPIRED
created_at             TIMESTAMP
completed_at           TIMESTAMP
```

#### UserAnswer (ì‚¬ìš©ì ë‹µë³€)
```sql
answer_id     BIGINT PRIMARY KEY
session_id    BIGINT NOT NULL      -- GameSession ì°¸ì¡°
question_id   BIGINT NOT NULL      -- Question ì°¸ì¡°
selected_option CHAR(1) NOT NULL   -- 'A' ë˜ëŠ” 'B'
answered_at   TIMESTAMP
```

---

## ğŸ”’ ê¶Œí•œ ì²´ê³„

### ì—­í• ë³„ ê¶Œí•œ

#### ë¹„íšŒì› (ANONYMOUS)
- âœ… ê²Œì„ í”Œë ˆì´
- âœ… ì§ˆë¬¸ ë¬¶ìŒ ì¡°íšŒ
- âœ… ê³µìœ  ì½”ë“œë¡œ ê²°ê³¼ ë¹„êµ
- âŒ ì§ˆë¬¸ ìƒì„±
- âŒ ë§ˆì´í˜ì´ì§€ ì ‘ê·¼

#### ì¼ë°˜ íšŒì› (USER)
- âœ… ëª¨ë“  ë¹„íšŒì› ê¶Œí•œ
- âœ… ì§ˆë¬¸ ìƒì„± ìš”ì²­ (ìŠ¹ì¸ ëŒ€ê¸°)
- âœ… ì§ˆë¬¸ ë¬¶ìŒ ìƒì„±
- âœ… ë§ˆì´í˜ì´ì§€ ì ‘ê·¼
- âœ… ê²Œì„ ê¸°ë¡ ì €ì¥/ì¡°íšŒ

#### ê´€ë¦¬ì (ADMIN)
- âœ… ëª¨ë“  ì¼ë°˜ íšŒì› ê¶Œí•œ
- âœ… ì§ˆë¬¸ ìŠ¹ì¸/ê±°ì ˆ
- âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì ‘ê·¼
- âœ… ì‚¬ìš©ì ê´€ë¦¬

### JWT í† í° ì¸ì¦
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## ğŸ¯ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ê°€ì´ë“œ

### 1. ë¹„íšŒì› ê²Œì„ í”Œë ˆì´ í”Œë¡œìš°

```javascript
// 1. ì„ì‹œ ì‚¬ìš©ì ID ìƒì„±
const tempUserId = 'temp-' + Math.random().toString(36).substr(2, 9);

// 2. ê²Œì„ ì‹œì‘
const startResponse = await fetch('/api/game/start', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    bundleId: 1,
    tempUserId: tempUserId
  })
});
const gameSession = await startResponse.json();

// 3. ì§ˆë¬¸ë³„ ë‹µë³€ ì œì¶œ
for (let question of gameSession.questions) {
  await fetch('/api/game/answer', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      sessionId: gameSession.sessionId,
      questionId: question.questionId,
      selectedOption: 'A' // ì‚¬ìš©ì ì„ íƒ
    })
  });
}

// 4. ê²Œì„ ì™„ë£Œ ë° ê³µìœ ì½”ë“œ ë°›ê¸°
const completeResponse = await fetch(`/api/game/sessions/${gameSession.sessionId}/complete`, {
  method: 'POST'
});
const shareCodeData = await completeResponse.json();
console.log('ê³µìœ ì½”ë“œ:', shareCodeData.shareCode);
```

### 2. íšŒì› ë¡œê·¸ì¸ ë° í† í° ê´€ë¦¬

```javascript
// ë¡œê·¸ì¸
const loginResponse = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'password123'
  })
});
const authData = await loginResponse.json();

// í† í° ì €ì¥
localStorage.setItem('accessToken', authData.accessToken);
localStorage.setItem('refreshToken', authData.refreshToken);

// ì¸ì¦ì´ í•„ìš”í•œ API í˜¸ì¶œ ì‹œ
const response = await fetch('/api/my/stats', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
  }
});
```

### 3. ê³µìœ ì½”ë“œ ë¹„êµ í”Œë¡œìš°

```javascript
// 1. ê³µìœ ì½”ë“œë¡œ ì›ë³¸ ì„¸ì…˜ ì •ë³´ ì¡°íšŒ
const originalSession = await fetch(`/api/game/share/${shareCode}`);
const originalData = await originalSession.json();

// 2. ê°™ì€ ë¬¶ìŒìœ¼ë¡œ ìƒˆ ê²Œì„ ì‹œì‘
const compareGameResponse = await fetch('/api/game/start', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    bundleId: originalData.bundleId,
    shareCode: shareCode,
    tempUserId: 'temp-' + Math.random().toString(36).substr(2, 9)
  })
});

// 3. ê²Œì„ ì™„ë£Œ í›„ ë¹„êµ
const comparison = await fetch(`/api/game/compare?shareCode=${shareCode}&compareSessionId=${newSessionId}`, {
  method: 'POST'
});
const comparisonResult = await comparison.json();
```

---

## ğŸš¨ ì—ëŸ¬ ì²˜ë¦¬

### HTTP ìƒíƒœ ì½”ë“œ
- **200 OK**: ìš”ì²­ ì„±ê³µ
- **201 Created**: ë¦¬ì†ŒìŠ¤ ìƒì„± ì„±ê³µ  
- **400 Bad Request**: ì˜ëª»ëœ ìš”ì²­ ë°ì´í„°
- **401 Unauthorized**: ì¸ì¦ í•„ìš”
- **403 Forbidden**: ê¶Œí•œ ì—†ìŒ
- **404 Not Found**: ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
- **500 Internal Server Error**: ì„œë²„ ì˜¤ë¥˜

### ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
```json
{
  "status": 400,
  "error": "Bad Request",
  "message": "í•„ìˆ˜ í•„ë“œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "timestamp": "2024-01-15T10:30:00",
  "path": "/api/game/start"
}
```

### í”„ë¡ íŠ¸ì—”ë“œ ì—ëŸ¬ ì²˜ë¦¬ ì˜ˆì‹œ
```javascript
try {
  const response = await fetch('/api/game/start', options);
  
  if (!response.ok) {
    const errorData = await response.json();
    throw new Error(errorData.message || 'ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
  
  return await response.json();
} catch (error) {
  console.error('API ì˜¤ë¥˜:', error.message);
  // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
  alert(error.message);
}
```

---

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™” ê³ ë ¤ì‚¬í•­

### 1. í˜ì´ì§• ì²˜ë¦¬
ëª¨ë“  ëª©ë¡ ì¡°íšŒ APIëŠ” í˜ì´ì§•ì„ ì§€ì›í•©ë‹ˆë‹¤:
```javascript
// ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ ì‹œ
const response = await fetch('/api/questions/popular?page=0&size=20');
```

### 2. ì´ë¯¸ì§€ ìµœì í™”
- ì´ë¯¸ì§€ëŠ” Azure Blob Storageì— ì €ì¥
- ì ì ˆí•œ í¬ê¸°ë¡œ ë¦¬ì‚¬ì´ì§• í›„ ì—…ë¡œë“œ ê¶Œì¥
- CDNì„ í†µí•œ ë¹ ë¥¸ ì´ë¯¸ì§€ ë¡œë”©

### 3. ìºì‹± ì „ëµ
- ì¸ê¸° ì§ˆë¬¸ì€ Redis ìºì‹œ í™œìš©
- ì •ì  ë°ì´í„°(í‚¤ì›Œë“œ ë“±)ëŠ” í´ë¼ì´ì–¸íŠ¸ ìºì‹± ê¶Œì¥

---

## ğŸ”§ ê°œë°œ í™˜ê²½ ì„¤ì •

### ë¡œì»¬ ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì‹¤í–‰ (Docker)
docker-compose up -d

# ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰
./gradlew bootRun
```

### CORS ì„¤ì •
í˜„ì¬ ëª¨ë“  originì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤:
```java
@CrossOrigin(origins = "*")
```

### í™˜ê²½ë³€ìˆ˜ ì„¤ì •
`application-secret.yml` íŒŒì¼ì— ë‹¤ìŒ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤:
```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/balance_game
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    
jwt:
  secret: ${JWT_SECRET}
  
azure:
  storage:
    connection-string: ${AZURE_STORAGE_CONNECTION_STRING}
```

---

## ğŸ”„ ë°°í¬ ë° CI/CD

### Azure ë°°í¬ íŒŒì´í”„ë¼ì¸
- GitHub Actionsì„ í†µí•œ ìë™ ë°°í¬
- `azure-pipelines.yml` íŒŒì¼ë¡œ ë°°í¬ ì„¤ì • ê´€ë¦¬
- PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ëŠ” Azure Database for PostgreSQL ì‚¬ìš©

### ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • í™•ì¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] CORS ì„¤ì • í”„ë¡œë•ì…˜ í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •
- [ ] JWT ì‹œí¬ë¦¿ í‚¤ ë³´ì•ˆ ì„¤ì •
- [ ] Azure Storage ì—°ê²° í™•ì¸

---

## ğŸ“ ë¬¸ì˜ ë° í˜‘ì—…

### API í…ŒìŠ¤íŠ¸
- Postman ì»¬ë ‰ì…˜ ì œê³µ ê°€ëŠ¥
- Swagger UI: `/swagger-ui.html` (ê°œë°œ í™˜ê²½)

### ê°œë°œ ì§„í–‰ ìƒí™©
- í˜„ì¬ ëª¨ë“  í•µì‹¬ API êµ¬í˜„ ì™„ë£Œ
- ê´€ë¦¬ì ê¸°ëŠ¥ ì¼ë¶€ ì¶”ê°€ ê°œë°œ ì¤‘
- ì„±ëŠ¥ ìµœì í™” ë° ë³´ì•ˆ ê°•í™” ì§„í–‰ ì¤‘

ì´ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì„ ì§„í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ì¶”ê°€ ì§ˆë¬¸ì´ë‚˜ API ìˆ˜ì • ìš”ì²­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš”! ğŸš€